/*
 * Menu
 ***********************/
$(".overlay").mouseleave(
	function () {
		$(this).parent().children(".overlay-title").show();			
	}
);				

$(".overlay").mouseover(
	function () {
		$(this).parent().children(".overlay-title").hide();			
	}
);

var $loading = $("#loading");
var windowH = $(window).height();
var windowW = $(window).width();

$loading.css({
 position:"fixed",
 left: ( ((windowW - $loading.outerWidth()) - $(document).scrollLeft() - 20 )),
 top: ( ((windowH - $loading.outerHeight()) - $(document).scrollTop() -20 ))
});

/*
 * Login
 ***********************/
function cpfCnpj(v){
	// Remove tudo o que não é dígito
	v=v.replace(/\D/g,"");	
	if (v.length < 11) { // CPF	
		// Coloca um ponto entre o terceiro e o quarto dígitos
		v=v.replace(/(\d{3})(\d)/,"$1.$2");
		
		// Coloca um ponto entre o terceiro e o quarto dígitos
		// de novo (para o segundo bloco de números)
		v=v.replace(/(\d{3})(\d)/,"$1.$2");

		// Coloca um hífen entre o terceiro e o quarto dígitos
		v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2");		
	} else { // CNPJ
		// Define tamanho máximo do campo
		if (v.length >= 14)
			v = v.substring(0, 13);
		
		// Coloca ponto entre o segundo e o terceiro dígitos
		v=v.replace(/^(\d{2})(\d)/,"$1.$2");
	
		// Coloca ponto entre o quinto e o sexto dígitos
		v=v.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3");
		
		// Coloca uma barra entre o oitavo e o nono dígitos
		v=v.replace(/\.(\d{3})(\d)/,".$1/$2");
		
		// Coloca um hífen depois do bloco de quatro dígitos
		v=v.replace(/(\d{4})(\d)/,"$1-$2");	
	}
	return v;
}

function executeMaskComponente(idComponente) {
	$(idComponente).val(cpfCnpj($(idComponente).val()));
}

function executeMask() {
	$("#j_username").val(cpfCnpj($("#j_username").val()));
}

$("#j_username").keypress(function(e) {
	console.log( e.keyCode);
	if(e.keyCode != 9 && e.keyCode != 13) { // tab && enter
		setTimeout(executeMask(), 1);
	}
});
$("#j_username").blur(function() {
	clearTimeout();
});

/*
 * Header options
 ***********************/
function changeCurrentUnit_ajax(unit) {
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	var request = $.ajax({
		  url: $("#_path").val() + "api/login/currentunit",		  
		  type: "PUT",
		  dataType: "json",
		  beforeSend: function (xhr) {
			    xhr.setRequestHeader(header,token);
		  },
		  data: {"unit": unit}
		});

		request.done(function(data, textStatus, jqXHR) {			
		  if (jqXHR.status == 200) {
			window.location.reload(true);
		  }
		});

		request.fail(function(jqXHR, textStatus) {			
			alert('Houve um problema ao realizar sua consulta. Tente novamente mais tarde.');
		});
}

$(".window-row a").click(function() {
	var unit = $(this).attr("data-unit");	
	if (unit != null && $("#_currentUnit").val() != unit) {
		changeCurrentUnit_ajax(unit);
	}
});

/*
 * chart
 ***********************/

function showTooltip(x, y, contents) {
	$("<div id='tooltip' class='tooltip in'><div class='tooltip-inner'>" + contents + "</div></div>").css({
		top: y + 5,
		left: x
	}).appendTo("body").fadeIn(200);
}

$(function() {
	$('#registration_popover').popover([]);
});

/*
* general
 ***********************/

function urldecode(str) {
	return decodeURIComponent((str+'').replace(/\+/g, '%20'));
}