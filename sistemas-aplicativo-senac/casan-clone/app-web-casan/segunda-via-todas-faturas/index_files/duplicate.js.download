$(document).ready(function(){
	
	$('#tabBills a').click(function (e) {
	  e.preventDefault();
	  $(this).tab('show');
	});
	
	$('#accordionBill a').click(function (e) {		
		var year = $(this).attr("data-content");
		var element = '#collapse' + year + ' .accordion-inner table tbody';
		var content = $(element).html();
		if (content == '') {
			getBillsByYear_ajax(year, element);
		}
	});
	
	function getBillsByYear_ajax(year, element) {	
		
		var request = $.ajax({
			  url: $("#_path").val() + "api/bill/bills_by_year/" + year,		  
			  type: "GET",
			  dataType: "json",
			  contentType: "application/x-www-form-urlencoded; charset=UTF-8"
			});
	
			request.done(function(data, textStatus, jqXHR) {
			  if (jqXHR.status == 200) {			  	
				var result = "";
				$.each(data, function(index, value) {
					result += '<tr><td>' + value["formatted_reference_date"] + '</td>';
					result += '<td class="show-bigger-500px">' + value["deadline"] + '</td>';
					result += '<td class="show-bigger-500px"> R$ ' + value["currency_value"] + '</td>';				
					if (value["situation_id"] == 0  || value["situation_id"] == 3) result += '<td class="message-error show-bigger-500px">'; else result += '<td class="show-bigger-500px">';
					
					if( value["situation_id"] == 7) {
						result += "Em Alteração" + '</td>';
					} else {
						result += value["situation_description"] + '</td>';
					}

					result += '<td><a target="_blank" href="' + $("#_path").val() + 'segundavia/download/' + value["reference_date"] + '/' + value["differ_number"] +'"><i class="icon-print"></i></a></td>';

					result += '</tr>';
				});						  
				$(element).html(result);
			  }
			});
	
			request.fail(function(jqXHR, textStatus) {
				var alertStr = 'Não foi possível listar suas faturas. Tente novamente mais tarde.';
				alert(alertStr);
			});
	}
	
	$('.btn-copy').on('click', function(){
    	$(this).attr("data-content");
    	var path = $(this).attr("data-content");
        path = path.replace(/ &amp;gt; /g,".");
        $('#copypath').val(path);
    }); 
    
    $('#barcodeWindow').on('shown', function () {
    	 $('#copypath').focus();
         $('#copypath').select();
    });    
});